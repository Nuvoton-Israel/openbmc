From 82caf0f0569f459e9710cfa21a64b2acb1756045 Mon Sep 17 00:00:00 2001
From: Tim Lee <timlee660101@gmail.com>
Date: Mon, 20 Jun 2022 15:36:09 +0800
Subject: [PATCH 3/5] Create new user without SSH group

Remove SSH group permission from default groups when create new user.

Signed-off-by: Brian Ma <chma0@nuvoton.com>
Signed-off-by: Tim Lee <timlee660101@gmail.com>
---
 redfish-core/lib/account_service.hpp | 13 ++++++++++++-
 1 file changed, 12 insertions(+), 1 deletion(-)

diff --git a/redfish-core/lib/account_service.hpp b/redfish-core/lib/account_service.hpp
index 898040c53..943192bbe 100644
--- a/redfish-core/lib/account_service.hpp
+++ b/redfish-core/lib/account_service.hpp
@@ -1623,6 +1623,17 @@ inline void requestAccountServiceRoutes(App& app)
                 return;
             }
 
+            // Remove ssh from all group list
+            std::vector<std::string> nonSshGroups;
+            for (auto group = allGroupsList.begin();
+                 group != allGroupsList.end(); ++group)
+            {
+                if (*group != "ssh")
+                {
+                    nonSshGroups.push_back(*group);
+                }
+            }
+
             crow::connections::systemBus->async_method_call(
                 [asyncResp, username,
                  password](const boost::system::error_code ec2,
@@ -1672,7 +1683,7 @@ inline void requestAccountServiceRoutes(App& app)
                 },
                 "xyz.openbmc_project.User.Manager", "/xyz/openbmc_project/user",
                 "xyz.openbmc_project.User.Manager", "CreateUser", username,
-                allGroupsList, *roleId, *enabled);
+                nonSshGroups, *roleId, *enabled);
                     });
             });
 
-- 
2.17.1

